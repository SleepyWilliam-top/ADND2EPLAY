<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>å¿«é€Ÿæµ‹è¯•ç¥ç¥‡è§£æ</title>
    <style>
        body {
            font-family: monospace;
            padding: 20px;
            background: #1e1e1e;
            color: #d4d4d4;
        }
        .test { margin: 20px 0; padding: 15px; background: #2d2d2d; border-left: 4px solid #4CAF50; }
        .success { color: #4CAF50; }
        .fail { color: #f44336; }
        pre { background: #1e1e1e; padding: 10px; overflow-x: auto; }
    </style>
</head>
<body>
    <h1>ğŸ” ç¥ç¥‡è§£ææµ‹è¯•</h1>
    <div id="output"></div>
    
    <script>
        function parseDeityFromCharacterBackground(background) {
            if (!background) return null;

            const deityPatterns = [
                /(?:æˆä¸º|æ™‹å‡ä¸º|è·å¾—äº†?|å·²ç»æ˜¯|ç°åœ¨æ˜¯)([åŠ]?ç¥|å®ˆæŠ¤[åŠ]?ç¥|ç¥[ç¥‡ç¥—])/,
                /ç¥æ ¼|ç¥åŠ›|ç¥æ€§/,
            ];

            let isDivine = false;
            for (const pattern of deityPatterns) {
                if (pattern.test(background)) {
                    isDivine = true;
                    break;
                }
            }

            if (!isDivine) return null;

            let divineRank = 'demigod';
            if (/åŠç¥/.test(background)) divineRank = 'demigod';
            else if (/å¼±ç­‰ç¥|æ¬¡çº§ç¥/.test(background)) divineRank = 'lesser';
            else if (/ä¸­ç­‰ç¥/.test(background)) divineRank = 'intermediate';
            else if (/é«˜ç­‰ç¥|å¼ºå¤§ç¥/.test(background)) divineRank = 'greater';

            const portfolios = [];
            const bracketPattern = /ã€ç¥èŒ[ï¼š:]\s*([^ã€‘]+)ã€‘/g;
            let match;
            while ((match = bracketPattern.exec(background)) !== null) {
                const domains = match[1].trim().split(/[ã€ï¼Œ,]/);
                portfolios.push(...domains.map(d => d.trim()).filter(d => d));
            }

            if (portfolios.length === 0) {
                const portfolioPattern = /ç¥èŒ[ï¼š:]\s*([^ã€‚ï¼ï¼Ÿ\nã€ã€‘]+)/g;
                while ((match = portfolioPattern.exec(background)) !== null) {
                    const domains = match[1].trim().split(/[ã€ï¼Œ,]/);
                    portfolios.push(...domains.map(d => d.trim()).filter(d => d));
                }
            }

            return {
                type: 'update_deity',
                data: { divineRank, portfolios },
            };
        }

        const userBackground = 'è¿‡å»æ˜¯åŒ—æ–¹ç»Ÿä¸€çš„ç‹¼è£”éƒ¨è½çš„å¼ºå¤§å±•ç¤ºï¼Œæœ€åå€ŸåŠ©é¦–é¢†å’ŒåŒæ—ä»¬çš„å¸®åŠ©æˆä¸ºç‹¼è£”çš„å®ˆæŠ¤ç¥ï¼Œå› ä¸ºæ˜¯åŠç¥ï¼Œæ‰€ä»¥å¯ä»¥å±…ä½åœ¨ç‰©è´¨ä½é¢ï¼Œä¸ä¼šè¢«è¿«å»å…¶ä»–ä½é¢ã€ç¥èŒï¼šç‹¼è£”ã€æ€§çˆ±ï¼ˆé›„æ€§é—´çš„åŒæ€§äº¤é…ï¼‰ã€å®¿å‘½è®ºã€‘';

        const result = parseDeityFromCharacterBackground(userBackground);

        document.getElementById('output').innerHTML = `
            <div class="test">
                <h2>ğŸ“ è¾“å…¥æ–‡æœ¬</h2>
                <pre>${userBackground}</pre>
            </div>
            <div class="test">
                <h2>ğŸ”¬ è§£æç»“æœ</h2>
                ${result ? `<p class="success">âœ… æˆåŠŸæ£€æµ‹åˆ°ç¥ç¥‡ä¿¡æ¯ï¼</p>` : `<p class="fail">âŒ æœªæ£€æµ‹åˆ°ç¥ç¥‡ä¿¡æ¯</p>`}
                <pre>${JSON.stringify(result, null, 2)}</pre>
            </div>
            <div class="test">
                <h2>ğŸ’¡ é¢„æœŸç»“æœ</h2>
                <pre>{
  "type": "update_deity",
  "data": {
    "divineRank": "demigod",
    "portfolios": ["ç‹¼è£”", "æ€§çˆ±ï¼ˆé›„æ€§é—´çš„åŒæ€§äº¤é…ï¼‰", "å®¿å‘½è®º"]
  }
}</pre>
            </div>
        `;
    </script>
</body>
</html>

