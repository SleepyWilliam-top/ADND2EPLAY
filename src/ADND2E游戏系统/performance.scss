/**
 * ADND 2E 性能优化 CSS
 *
 * 包含性能优化的 CSS 类和技巧：
 * 1. GPU 加速
 * 2. CSS Containment
 * 3. 减少重排重绘
 * 4. 优化动画
 */

// ==================== GPU 加速 ====================

// 启用 GPU 加速（用于频繁变化的元素）
.gpu-accelerated {
  transform: translateZ(0);
  backface-visibility: hidden;
  perspective: 1000px;
  will-change: transform;
}

// 用于动画元素
.will-change-transform {
  will-change: transform;
}

.will-change-opacity {
  will-change: opacity;
}

// 动画结束后移除 will-change（需要 JS 配合）
.will-change-auto {
  will-change: auto;
}

// ==================== CSS Containment ====================

// 布局包含（防止子元素影响外部布局）
.contain-layout {
  contain: layout;
}

// 样式包含（隔离计数器和引用）
.contain-style {
  contain: style;
}

// 绘制包含（剪裁内容到边界）
.contain-paint {
  contain: paint;
  overflow: hidden; // paint containment 需要 overflow
}

// 尺寸包含（固定尺寸，忽略子元素）
.contain-size {
  contain: size;
}

// 完全包含（layout + style + paint）
.contain-strict {
  contain: strict; // layout + style + paint + size
}

// 内容包含（layout + style + paint，常用于列表项）
.contain-content {
  contain: content; // layout + style + paint
}

// ==================== 虚拟滚动优化 ====================

// 虚拟滚动容器
.virtual-scroll-container {
  overflow-y: auto;
  overflow-x: hidden;
  position: relative;
  contain: strict; // 完全隔离
  will-change: scroll-position;

  // 优化滚动性能
  -webkit-overflow-scrolling: touch;
  scroll-behavior: smooth;

  &::-webkit-scrollbar {
    width: 8px;
  }

  &::-webkit-scrollbar-track {
    background: #f5f5f5;
  }

  &::-webkit-scrollbar-thumb {
    background: #ccc;
    border-radius: 4px;

    &:hover {
      background: #999;
    }
  }
}

// 虚拟滚动项（使用 transform 而不是 top/left）
.virtual-scroll-item {
  position: absolute;
  left: 0;
  right: 0;
  contain: content; // 隔离布局和样式
  will-change: transform; // GPU 加速

  // 使用 transform 代替 top（性能更好）
  transform: translateY(var(--item-offset, 0));
}

// ==================== 列表项优化 ====================

// 优化的列表项（减少重排）
.optimized-list-item {
  contain: content;
  display: block;
  min-height: 1px; // 防止 size containment 问题

  // 避免边距折叠
  padding: 1px 0;
}

// 卡片组件优化
.optimized-card {
  contain: content;
  display: block;
  position: relative;

  // 使用 transform 而不是 margin 实现间距
  &:not(:last-child) {
    margin-bottom: 0;
    transform: translateY(0);
  }
}

// ==================== 动画优化 ====================

// 仅使用 transform 和 opacity 的动画（GPU 加速）
@keyframes fade-in-optimized {
  from {
    opacity: 0;
    transform: translateY(10px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

@keyframes fade-out-optimized {
  from {
    opacity: 1;
    transform: scale(1);
  }
  to {
    opacity: 0;
    transform: scale(0.95);
  }
}

@keyframes slide-in-optimized {
  from {
    transform: translateX(-100%);
  }
  to {
    transform: translateX(0);
  }
}

// 性能优化的淡入
.fade-in-fast {
  animation: fade-in-optimized 0.2s ease-out forwards;
  will-change: opacity, transform;
}

// 性能优化的淡出
.fade-out-fast {
  animation: fade-out-optimized 0.2s ease-in forwards;
  will-change: opacity, transform;
}

// ==================== 防止布局抖动 ====================

// 固定尺寸容器（防止内容加载时抖动）
.fixed-size-container {
  // 使用 aspect-ratio 或固定高度
  min-height: var(--min-height, 100px);

  // 防止子元素撑大容器
  overflow: hidden;
  contain: layout size;
}

// 骨架屏容器
.skeleton-container {
  position: relative;
  overflow: hidden;
  background: linear-gradient(90deg, #f0f0f0 0%, #e0e0e0 50%, #f0f0f0 100%);
  background-size: 200% 100%;
  animation: skeleton-loading 1.5s ease-in-out infinite;
  contain: paint;
}

@keyframes skeleton-loading {
  0% {
    background-position: 200% 0;
  }
  100% {
    background-position: -200% 0;
  }
}

// ==================== 减少重绘 ====================

// 使用 transform 代替 position 变化
.transform-position {
  position: relative;
  // 不使用 top/left/right/bottom
  // 改用 transform: translate()
  transform: translate(var(--x, 0), var(--y, 0));
  will-change: transform;
}

// 使用 transform 代替 width/height 变化
.transform-scale {
  transform: scale(var(--scale, 1));
  transform-origin: center;
  will-change: transform;
}

// ==================== 响应式优化 ====================

// 隐藏元素（避免渲染）
.display-none-optimized {
  display: none !important;
  // 或使用 content-visibility: hidden (更现代)
  // content-visibility: hidden;
}

// 懒加载占位符
.lazy-placeholder {
  min-height: var(--placeholder-height, 200px);
  background: #f5f5f5;
  contain: strict;
}

// ==================== 移动端优化 ====================

// 禁用点击延迟
.no-tap-delay {
  touch-action: manipulation;
  -webkit-tap-highlight-color: transparent;
}

// 优化触摸滚动
.smooth-scroll {
  -webkit-overflow-scrolling: touch;
  scroll-behavior: smooth;
  overscroll-behavior: contain;
}

// ==================== 文本渲染优化 ====================

// 优化文本渲染
.optimized-text {
  // 次像素渲染
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;

  // 使用系统字体栈（更快）
  font-family:
    system-ui,
    -apple-system,
    BlinkMacSystemFont,
    'Segoe UI',
    'Roboto',
    'Helvetica Neue',
    Arial,
    sans-serif;

  // 禁用连字（提升性能）
  font-variant-ligatures: none;

  // 优化文本渲染速度
  text-rendering: optimizeSpeed;
}

// 长文本优化
.long-text-optimized {
  // 使用 CSS 剪裁代替 JS
  display: -webkit-box;
  -webkit-line-clamp: 3;
  -webkit-box-orient: vertical;
  overflow: hidden;
  text-overflow: ellipsis;

  // 单行文本截断
  &.single-line {
    display: block;
    -webkit-line-clamp: unset;
    -webkit-box-orient: unset;
    white-space: nowrap;
  }
}

// ==================== 实用工具类 ====================

// 内容可见性（现代浏览器懒渲染）
.content-visibility-auto {
  content-visibility: auto;
  contain-intrinsic-size: var(--intrinsic-size, auto 500px);
}

// 强制硬件加速
.force-hardware-acceleration {
  transform: translate3d(0, 0, 0);
  backface-visibility: hidden;
  perspective: 1000px;
}

// 隔离合成层（防止层爆炸）
.isolate-layer {
  isolation: isolate;
}

// 防止用户选择（提升交互性能）
.no-select {
  user-select: none;
  -webkit-user-select: none;
  -moz-user-select: none;
  -ms-user-select: none;
}
